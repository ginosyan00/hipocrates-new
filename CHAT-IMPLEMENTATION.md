# Chat Implementation - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∞—Ç–∞ –¥–ª—è —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∫–ª–∏–Ω–∏–∫–∏ CRM —Å–∏—Å—Ç–µ–º—ã. –ß–∞—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞–º –æ–±—â–∞—Ç—å—Å—è —Å –≤—Ä–∞—á–∞–º–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ –∫–ª–∏–Ω–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ù–æ–≤–æ–µ: –í—ã–±–æ—Ä –≤—Ä–∞—á–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –±–µ—Å–µ–¥—ã
- –ü–∞—Ü–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –≤—ã–±—Ä–∞—Ç—å –≤—Ä–∞—á–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–π –±–µ—Å–µ–¥—ã
- –ö–Ω–æ–ø–∫–∞ "+ –ù–æ–≤—ã–π —á–∞—Ç" –≤ —Å–ø–∏—Å–∫–µ –±–µ—Å–µ–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–µ—Å–µ–¥—ã —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –≤—Ä–∞—á–æ–º
- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≤—Ä–∞—á–∞

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### Backend (Node.js + Express + Prisma)

1. **–ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   - `Conversation` - –±–µ—Å–µ–¥—ã –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
   - `Message` - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–µ—Å–µ–¥–∞—Ö

2. **API Endpoints:**
   - `GET /api/v1/chat/conversations` - —Å–ø–∏—Å–æ–∫ –±–µ—Å–µ–¥
   - `GET /api/v1/chat/conversations/:id` - –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–µ–¥—É
   - `GET /api/v1/chat/messages/:conversationId` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
   - `POST /api/v1/chat/messages` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
   - `POST /api/v1/chat/conversations/:id/read` - –æ—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
   - `GET /api/v1/chat/unread-count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

3. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–µ—Å–µ–¥
   - –ü–æ–¥—Å—á–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–æ–ª—è–º (PATIENT, DOCTOR, ADMIN)
   - Multi-tenancy (–∏–∑–æ–ª—è—Ü–∏—è –ø–æ clinicId)

### Frontend (React + TypeScript + Tailwind CSS)

1. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
   - `PatientChat` - –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∞—Ç–∞
   - `ChatMessage` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - `ChatInput` - –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Enter

2. **Hooks (React Query):**
   - `useConversations()` - —Å–ø–∏—Å–æ–∫ –±–µ—Å–µ–¥ —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º (3 —Å–µ–∫)
   - `useMessages()` - —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ—Å–µ–¥—ã —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º (2 —Å–µ–∫)
   - `useSendMessage()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
   - `useUnreadCount()` - —Å—á–µ—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (5 —Å–µ–∫)

3. **–§—É–Ω–∫—Ü–∏–∏:**
   - ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ —Å –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª–æ–º
   - ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
   - ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (mobile-friendly)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ polling
   - ‚úÖ –û—Ç–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```tsx
import { PatientChat } from './components/chat/PatientChat';

function App() {
  const [isChatOpen, setIsChatOpen] = useState(false);

  return (
    <>
      <button onClick={() => setIsChatOpen(true)}>–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç</button>
      
      <PatientChat
        isOpen={isChatOpen}
        onClose={() => setIsChatOpen(false)}
        mode="sidebar" // –∏–ª–∏ "modal"
        width="450px"
        height="600px"
      />
    </>
  );
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Header (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

–ß–∞—Ç —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `Header.tsx` —Å –∫–Ω–æ–ø–∫–æ–π –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

### –†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

1. **Modal** - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞
   ```tsx
   <PatientChat isOpen={true} onClose={handleClose} mode="modal" />
   ```

2. **Sidebar** - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞
   ```tsx
   <PatientChat isOpen={true} onClose={handleClose} mode="sidebar" width="450px" />
   ```

## üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å

- **Desktop**: –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é —Å–ø–∏—Å–∫–∞ –±–µ—Å–µ–¥
- **Tablet**: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —à–∏—Ä–∏–Ω–∞, —Å–∫—Ä—ã–≤–∞–µ–º—ã–π —Å–ø–∏—Å–æ–∫ –±–µ—Å–µ–¥
- **Mobile**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Å–ø–∏—Å–æ–∫ –±–µ—Å–µ–¥ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è

## üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–ß–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç polling –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
- –ë–µ—Å–µ–¥—ã: –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
- –°–æ–æ–±—â–µ–Ω–∏—è: –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã (–∫–æ–≥–¥–∞ —á–∞—Ç –æ—Ç–∫—Ä—ã—Ç)
- –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

## üé® –î–∏–∑–∞–π–Ω

–ß–∞—Ç —Å–ª–µ–¥—É–µ—Ç –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ–µ–∫—Ç–∞:
- –¶–≤–µ—Ç–∞ –∏–∑ `DESIGN-SYSTEM.md`
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ç–∏–ª—å
- –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
- –ò–∫–æ–Ω–∫–∏ –∏ —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (JWT)
- Multi-tenancy: –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ clinicId
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–µ—Å–µ–¥–∞–º –ø–æ —Ä–æ–ª—è–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Joi

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ—Å–µ–¥–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
2. **–î–ª—è –≤—Ä–∞—á–µ–π**: –í–∏–¥—è—Ç –±–µ—Å–µ–¥—ã, –≥–¥–µ –æ–Ω–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏, –∏–ª–∏ –≤—Å–µ –±–µ—Å–µ–¥—ã –∫–ª–∏–Ω–∏–∫–∏
3. **–î–ª—è –∞–¥–º–∏–Ω–æ–≤**: –í–∏–¥—è—Ç –≤—Å–µ –±–µ—Å–µ–¥—ã –∫–ª–∏–Ω–∏–∫–∏

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (–≤–º–µ—Å—Ç–æ polling)
- [ ] Typing indicator ("–í—Ä–∞—á –ø–µ—á–∞—Ç–∞–µ—Ç...")
- [ ] –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- [ ] –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## üìö –§–∞–π–ª—ã

### Backend
- `backend/prisma/schema.prisma` - –º–æ–¥–µ–ª–∏ Conversation –∏ Message
- `backend/src/services/chat.service.js` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- `backend/src/controllers/chat.controller.js` - API handlers
- `backend/src/routes/chat.routes.js` - –º–∞—Ä—à—Ä—É—Ç—ã
- `backend/src/validators/chat.validator.js` - –≤–∞–ª–∏–¥–∞—Ü–∏—è

### Frontend
- `frontend/src/components/chat/PatientChat.tsx` - –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `frontend/src/components/chat/ChatMessage.tsx` - —Å–æ–æ–±—â–µ–Ω–∏–µ
- `frontend/src/components/chat/ChatInput.tsx` - –ø–æ–ª–µ –≤–≤–æ–¥–∞
- `frontend/src/services/chat.service.ts` - API –∫–ª–∏–µ–Ω—Ç
- `frontend/src/hooks/useChat.ts` - React Query hooks

---

**–°–æ–∑–¥–∞–Ω–æ:** 18.01.2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

